"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(i,u){try{var o=t[i](u),a=o.value}catch(e){return void n(e)}return o.done?void e(a):Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)})}return r("next")})}}exports.__esModule=!0,exports.cleanupTask=exports.writeTask=exports.downloadTasks=void 0;exports.writeTask=(()=>{var e=_asyncToGenerator(function*(){yield _fsJetpack2.default.writeAsync(n,`${u.join("\n")}`)});return function(){return e.apply(this,arguments)}})(),exports.cleanupTask=(()=>{var e=_asyncToGenerator(function*(){const e=[...i.map(function(e){return e.name}),"plugins.zsh"],n=_fsJetpack2.default.list(t);n&&n.filter(function(t){return!(0,_includes2.default)(e,t)}).forEach(function(e){return _fsJetpack2.default.remove(_path2.default.join(t,e))})});return function(){return e.apply(this,arguments)}})();var _path=require("path"),_path2=_interopRequireDefault(_path),_fsJetpack=require("fs-jetpack"),_fsJetpack2=_interopRequireDefault(_fsJetpack),_entries=require("lodash/entries"),_entries2=_interopRequireDefault(_entries),_includes=require("lodash/includes"),_includes2=_interopRequireDefault(_includes),_mkdirp=require("mkdirp"),_mkdirp2=_interopRequireDefault(_mkdirp),_toml=require("toml"),_toml2=_interopRequireDefault(_toml),_index=require("./index");const e=_index.paths.configFile,t=_index.paths.downloadDir,n=_index.paths.sourceFile;(0,_mkdirp2.default)(t);const r=_toml2.default.parse(_fsJetpack2.default.read(e,"utf8")),i=(0,_entries2.default)(r),u=new Array(i.length);exports.downloadTasks=i.map((e,t)=>{return{title:`Downloading ${e[1].github||e[1]}...`,task(){return _asyncToGenerator(function*(){const n=i[t]=new _index.Plugin(e);_fsJetpack2.default.exists(n.downloadPath)?yield n.update():yield n.download(),u[t]=yield n.entry()})()}}});