"use strict";function e(e){return e&&e.__esModule?e:{default:e}}function t(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){function a(e,t){try{var r=u[e](t),l=r.value}catch(e){return void i(e)}r.done?n(l):Promise.resolve(l).then(o,function(e){a("throw",e)})}function o(e){a("next",e)}var u=e.apply(t,r);o()})}}exports.__esModule=!0,exports.cleanupTask=exports.writeTask=exports.downloadTasks=void 0;var r=e(require("path")),n=e(require("lodash/entries")),i=e(require("fs-extra")),a=e(require("lodash/includes")),o=e(require("mkdirp")),u=e(require("toml")),l=require("./index");const{configFile:d,downloadDir:s,sourceFile:f}=l.paths;(0,o.default)(s);const c=u.default.parse(i.default.readFileSync(d,"utf8")),p=(0,n.default)(c),h=Array(p.length),y=p.map((e,r)=>({title:`Downloading ${e[1].github||e[1]}...`,task:()=>t(function*(){p[r]=new l.Plugin(e),(yield i.default.pathExists(p[r].downloadPath))?yield p[r].update():yield p[r].download(),h[r]=yield p[r].entry()})()}));exports.downloadTasks=y;let w=(()=>{var e=t(function*(){yield i.default.writeFile(f,`${h.join("\n")}`)});return function(){return e.apply(this,arguments)}})();exports.writeTask=w;let v=(()=>{var e=t(function*(){const e=[...p.map(e=>e.name),"plugins.zsh"],t=yield i.default.readdir(s);t&&t.filter(t=>!(0,a.default)(e,t)).forEach(e=>i.default.removeSync(r.default.join(s,e)))});return function(){return e.apply(this,arguments)}})();exports.cleanupTask=v;