"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(i,u){try{var a=t[i](u),o=a.value}catch(e){return void n(e)}return a.done?void e(o):Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)})}return r("next")})}}exports.__esModule=!0,exports.cleanupTask=exports.writeTask=exports.downloadTasks=void 0;exports.writeTask=(()=>{var e=_asyncToGenerator(function*(){yield _fsJetpack2.default.writeAsync(sourceFile,`${n.join("\n")}`)});return function(){return e.apply(this,arguments)}})(),exports.cleanupTask=(()=>{var e=_asyncToGenerator(function*(){const e=[...t.map(function(e){return e.name}),"plugins.zsh"],n=_fsJetpack2.default.list(downloadDir);n&&n.filter(function(t){return!(0,_includes2.default)(e,t)}).forEach(function(e){return _fsJetpack2.default.remove(_path2.default.join(downloadDir,e))})});return function(){return e.apply(this,arguments)}})();var _path=require("path"),_path2=_interopRequireDefault(_path),_fsJetpack=require("fs-jetpack"),_fsJetpack2=_interopRequireDefault(_fsJetpack),_entries=require("lodash/entries"),_entries2=_interopRequireDefault(_entries),_includes=require("lodash/includes"),_includes2=_interopRequireDefault(_includes),_mkdirp=require("mkdirp"),_mkdirp2=_interopRequireDefault(_mkdirp),_index=require("./index");const{configFile,downloadDir,sourceFile}=_index.paths;(0,_mkdirp2.default)(downloadDir);const e=require(configFile),t=(0,_entries2.default)(e),n=new Array(t.length);exports.downloadTasks=t.map((e,r)=>{return{title:`Downloading ${e[1].github||e[1]}...`,task(){return _asyncToGenerator(function*(){const i=t[r]=new _index.Plugin(e);_fsJetpack2.default.exists(i.downloadPath)?yield i.update():yield i.download(),n[r]=yield i.entry()})()}}});