"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(u,i){try{var o=t[u](i),a=o.value}catch(e){return void n(e)}return o.done?void e(a):Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)})}return r("next")})}}exports.__esModule=!0,exports.cleanupTask=exports.writeTask=exports.downloadTasks=void 0;exports.writeTask=(()=>{var e=_asyncToGenerator(function*(){const e=t.filter(function(e){return e}).map(function(e){return`source ${e}`}).join("\n"),r=n.filter(function(e){return e}).map(function(e){return`fpath+=${e}`}).join("\n");yield _fsJetpack2.default.writeAsync(sourceFile,`${e}
${r}`)});return function(){return e.apply(this,arguments)}})(),exports.cleanupTask=(()=>{var t=_asyncToGenerator(function*(){const t=[...e.map(function(e){return e.uniqueName}),"plugins.zsh"],n=_fsJetpack2.default.list(downloadDir);n&&n.filter(function(e){return!(0,_lodash2.default)(t,e)}).forEach(function(e){return _fsJetpack2.default.remove(_path2.default.join(downloadDir,e))})});return function(){return t.apply(this,arguments)}})();var _path=require("path"),_path2=_interopRequireDefault(_path),_fsJetpack=require("fs-jetpack"),_fsJetpack2=_interopRequireDefault(_fsJetpack),_lodash=require("lodash.includes"),_lodash2=_interopRequireDefault(_lodash),_mkdirp=require("mkdirp"),_mkdirp2=_interopRequireDefault(_mkdirp),_index=require("./index");const{configFile,downloadDir,sourceFile}=_index.paths;(0,_mkdirp2.default)(downloadDir);const e=require(configFile),t=new Array(e.length),n=new Array(e.length);exports.downloadTasks=e.map((r,u)=>{return{title:`Downloading ${r}...`,task(){return _asyncToGenerator(function*(){"string"==typeof e[u]&&(e[u]=new _index.Plugin(r));const i=e[u];_fsJetpack2.default.exists(i.getDownloadPath())?yield i.update():yield i.download(),t[u]=i.getSourceFile(),n[u]=i.getFpath()})()}}});