"use strict";var t=require("@babel/runtime-corejs3/helpers/interopRequireDefault");require("core-js/modules/es.array.iterator"),require("core-js/modules/es.promise"),exports.__esModule=!0,exports.Plugin=exports.paths=void 0;var e=t(require("path")),i=t(require("execa")),a=t(require("findup-sync")),s=t(require("fs-extra")),o=t(require("lodash/isString")),r=t(require("lodash/isFunction")),n=t(require("xdg-basedir"));const d={downloadDir:e.default.join(n.default.data,"zsh-goggles"),configFile:e.default.join(n.default.config,"zsh-goggles","config.toml"),sourceFile:e.default.join(n.default.data,"zsh-goggles","plugins.zsh")};exports.paths=d;const u={standalone:!0,source:!0,fpath:!0};exports.Plugin=class{constructor([t,i]){if(this.name=t,this.downloadPath=e.default.join(d.downloadDir,t),(0,o.default)(i))return this.config={...u},void(this.config.github=i);this.config={...u,...i}}get fpath(){const t=this.config.fpath;if(!1!==t)return(0,o.default)(t)?e.default.join(this.downloadPath,t):(0,r.default)(t)?t(this.downloadPath):this.downloadPath}get sourceFile(){const t=this.config.source;if(!1===t)return;if((0,o.default)(t))return e.default.join(this.downloadPath,t);if((0,r.default)(t))return t(this.downloadPath);const i=[`${this.name}?(.plugin).?(z)sh`,"*.plugin.zsh","init.zsh","*.zsh","*.sh"];return(0,a.default)(i,{cwd:this.downloadPath,nocase:!0,maxdepth:0})}async entry(){let t="";return this.sourceFile&&(this.config.standalone?t+=await s.default.readFile(this.sourceFile):t+=`source ${this.sourceFile}`),this.fpath&&(t+=`\nfpath+=${this.fpath}`),t}async download(){await(0,i.default)("git",["clone","--recursive","--",`https://github.com/${this.config.github}.git`,this.downloadPath])}async update(){await(0,i.default)("git",["fetch","--all"],{cwd:this.downloadPath}),await(0,i.default)("git",["reset","--hard","origin/master","--"],{cwd:this.downloadPath})}};