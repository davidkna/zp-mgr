"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(i,a){try{var o=t[i](a),u=o.value}catch(e){return void n(e)}return o.done?void e(u):Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)})}return r("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0,exports.Plugin=exports.paths=void 0;var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_path=require("path"),_path2=_interopRequireDefault(_path),_execa=require("execa"),_execa2=_interopRequireDefault(_execa),_findupSync=require("findup-sync"),_findupSync2=_interopRequireDefault(_findupSync),_fsJetpack=require("fs-jetpack"),_fsJetpack2=_interopRequireDefault(_fsJetpack),_isString=require("lodash/isString"),_isString2=_interopRequireDefault(_isString),_isFunction=require("lodash/isFunction"),_isFunction2=_interopRequireDefault(_isFunction),_xdgBasedir=require("xdg-basedir"),_xdgBasedir2=_interopRequireDefault(_xdgBasedir),paths=exports.paths={downloadDir:_path2.default.join(_xdgBasedir2.default.data,"zsh-goggles"),configFile:_path2.default.join(_xdgBasedir2.default.config,"zsh-goggles","config.toml"),sourceFile:_path2.default.join(_xdgBasedir2.default.data,"zsh-goggles","plugins.zsh")},defaultConfig={standalone:!0,source:!0,fpath:!0},Plugin=exports.Plugin=function(){function e(t){var n=t[0],r=t[1];return _classCallCheck(this,e),this.name=n,this.downloadPath=_path2.default.join(paths.downloadDir,n),this.config={},Object.assign(this.config,defaultConfig),(0,_isString2.default)(r)?void(this.config.github=r):void Object.assign(this.config,r)}return e.prototype.entry=function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t="",!this.sourceFile){e.next=9;break}if(!this.config.standalone){e.next=8;break}return e.next=5,_fsJetpack2.default.readAsync(this.sourceFile);case 5:t+=e.sent,e.next=9;break;case 8:t+=`source ${this.sourceFile}`;case 9:return this.fpath&&(t+=`
fpath+=${this.fpath}`),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return e}(),e.prototype.download=function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_execa2.default)("git",["clone","--recursive","--",`https://github.com/${this.config.github}.git`,this.downloadPath]);case 2:case"end":return e.stop()}},e,this)}));return e}(),e.prototype.update=function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_execa2.default)("git",["fetch","--all"],{cwd:this.downloadPath});case 2:return e.next=4,(0,_execa2.default)("git",["reset","--hard","origin/master","--"],{cwd:this.downloadPath});case 4:case"end":return e.stop()}},e,this)}));return e}(),_createClass(e,[{key:"fpath",get:function(){var e=this.config.fpath;if(e!==!1)return(0,_isString2.default)(e)?_path2.default.join(this.downloadPath,e):(0,_isFunction2.default)(e)?e(this.downloadPath):this.downloadPath}},{key:"sourceFile",get:function(){var e=this.config.source;if(e!==!1){if((0,_isString2.default)(e))return _path2.default.join(this.downloadPath,e);if((0,_isFunction2.default)(e))return e(this.downloadPath);var t=[`${this.name}?(.plugin).?(z)sh`,"*.plugin.zsh","init.zsh","*.zsh","*.sh"];return(0,_findupSync2.default)(t,{cwd:this.downloadPath,nocase:!0,maxdepth:0})}}}]),e}();