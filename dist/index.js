"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _asyncToGenerator(t){return function(){var e=this,i=arguments;return new Promise(function(n,a){function o(t,e){try{var i=s[t](e),u=i.value}catch(t){return void a(t)}i.done?n(u):Promise.resolve(u).then(r,function(t){o("throw",t)})}function r(t){o("next",t)}var s=t.apply(e,i);r()})}}exports.__esModule=!0,exports.Plugin=exports.paths=void 0;var _path=_interopRequireDefault(require("path")),_execa=_interopRequireDefault(require("execa")),_findupSync=_interopRequireDefault(require("findup-sync")),_fsExtra=_interopRequireDefault(require("fs-extra")),_isString=_interopRequireDefault(require("lodash/isString")),_isFunction=_interopRequireDefault(require("lodash/isFunction")),_xdgBasedir=_interopRequireDefault(require("xdg-basedir"));const paths={downloadDir:_path.default.join(_xdgBasedir.default.data,"zsh-goggles"),configFile:_path.default.join(_xdgBasedir.default.config,"zsh-goggles","config.toml"),sourceFile:_path.default.join(_xdgBasedir.default.data,"zsh-goggles","plugins.zsh")};exports.paths=paths;const defaultConfig={standalone:!0,source:!0,fpath:!0};class Plugin{constructor([t,e]){this.name=t,this.downloadPath=_path.default.join(paths.downloadDir,t),this.config={},Object.assign(this.config,defaultConfig),(0,_isString.default)(e)?this.config.github=e:Object.assign(this.config,e)}get fpath(){const t=this.config.fpath;if(!1!==t)return(0,_isString.default)(t)?_path.default.join(this.downloadPath,t):(0,_isFunction.default)(t)?t(this.downloadPath):this.downloadPath}get sourceFile(){const t=this.config.source;if(!1===t)return;if((0,_isString.default)(t))return _path.default.join(this.downloadPath,t);if((0,_isFunction.default)(t))return t(this.downloadPath);const e=[`${this.name}?(.plugin).?(z)sh`,"*.plugin.zsh","init.zsh","*.zsh","*.sh"];return(0,_findupSync.default)(e,{cwd:this.downloadPath,nocase:!0,maxdepth:0})}entry(){var t=this;return _asyncToGenerator(function*(){let e="";return t.sourceFile&&(t.config.standalone?e+=(yield _fsExtra.default.read(t.sourceFile)):e+=`source ${t.sourceFile}`),t.fpath&&(e+=`\nfpath+=${t.fpath}`),e})()}download(){var t=this;return _asyncToGenerator(function*(){yield(0,_execa.default)("git",["clone","--recursive","--",`https://github.com/${t.config.github}.git`,t.downloadPath])})()}update(){var t=this;return _asyncToGenerator(function*(){yield(0,_execa.default)("git",["fetch","--all"],{cwd:t.downloadPath}),yield(0,_execa.default)("git",["reset","--hard","origin/master","--"],{cwd:t.downloadPath})})()}}exports.Plugin=Plugin;