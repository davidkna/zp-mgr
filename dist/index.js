"use strict";exports.__esModule=!0,exports.Plugin=exports.paths=void 0;var t=d(require("path")),e=d(require("execa")),i=d(require("findup-sync")),a=d(require("fs-extra")),s=d(require("lodash/isString")),o=d(require("lodash/isFunction")),n=d(require("xdg-basedir"));function d(t){return t&&t.__esModule?t:{default:t}}const h={downloadDir:t.default.join(n.default.data,"zsh-goggles"),configFile:t.default.join(n.default.config,"zsh-goggles","config.toml"),sourceFile:t.default.join(n.default.data,"zsh-goggles","plugins.zsh")};exports.paths=h;const l={standalone:!0,source:!0,fpath:!0};exports.Plugin=class{constructor([e,i]){if(this.name=e,this.downloadPath=t.default.join(h.downloadDir,e),(0,s.default)(i))return this.config={...l},void(this.config.github=i);this.config={...l,...i}}get fpath(){const e=this.config.fpath;if(!1!==e)return(0,s.default)(e)?t.default.join(this.downloadPath,e):(0,o.default)(e)?e(this.downloadPath):this.downloadPath}get sourceFile(){const e=this.config.source;if(!1===e)return;if((0,s.default)(e))return t.default.join(this.downloadPath,e);if((0,o.default)(e))return e(this.downloadPath);const a=[`${this.name}?(.plugin).?(z)sh`,"*.plugin.zsh","init.zsh","*.zsh","*.sh"];return(0,i.default)(a,{cwd:this.downloadPath,nocase:!0,maxdepth:0})}async entry(){let t="";return this.sourceFile&&(this.config.standalone?t+=await a.default.readFile(this.sourceFile):t+=`source ${this.sourceFile}`),this.fpath&&(t+=`\nfpath+=${this.fpath}`),t}async download(){await(0,e.default)("git",["clone","--recursive","--",`https://github.com/${this.config.github}.git`,this.downloadPath])}async update(){await(0,e.default)("git",["fetch","--all"],{cwd:this.downloadPath}),await(0,e.default)("git",["reset","--hard","origin/master","--"],{cwd:this.downloadPath})}};