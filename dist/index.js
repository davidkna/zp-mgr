"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){function n(a,r){try{var o=t[a](r),u=o.value}catch(e){return void i(e)}return o.done?void e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}exports.__esModule=!0,exports.Plugin=exports.paths=void 0;var _path=require("path"),_path2=_interopRequireDefault(_path),_execa=require("execa"),_execa2=_interopRequireDefault(_execa),_findupSync=require("findup-sync"),_findupSync2=_interopRequireDefault(_findupSync),_fsJetpack=require("fs-jetpack"),_fsJetpack2=_interopRequireDefault(_fsJetpack),_entries=require("lodash/entries"),_entries2=_interopRequireDefault(_entries),_isString=require("lodash/isString"),_isString2=_interopRequireDefault(_isString),_isFunction=require("lodash/isFunction"),_isFunction2=_interopRequireDefault(_isFunction),_xdgBasedir=require("xdg-basedir"),_xdgBasedir2=_interopRequireDefault(_xdgBasedir);const e=exports.paths={downloadDir:_path2.default.join(_xdgBasedir2.default.data,"zsh-goggles"),configFile:_path2.default.join(_xdgBasedir2.default.config,"zsh-goggles","config.js"),sourceFile:_path2.default.join(_xdgBasedir2.default.data,"zsh-goggles","plugins.zsh")},t={standalone:!0,source:!0,fpath:!0};class i{constructor([i,n]){return this.name=i,this.downloadPath=_path2.default.join(e.downloadDir,i),this.config={},Object.assign(this.config,t),(0,_isString2.default)(n)?void(this.config.github=n):void Object.assign(this.config,n)}get fpath(){const e=this.config.fpath;if(e!==!1)return(0,_isString2.default)(e)?_path2.default.join(this.downloadPath,e):(0,_isFunction2.default)(e)?e(this.downloadPath):this.downloadPath}get sourceFile(){const e=this.config.source;if(e!==!1){if((0,_isString2.default)(e))return _path2.default.join(this.downloadPath,e);if((0,_isFunction2.default)(e))return e(this.downloadPath);const t=[`${this.name}?(.plugin).?(z)sh`,"*.plugin.zsh","init.zsh","*.zsh","*.sh"];return(0,_findupSync2.default)(t,{cwd:this.downloadPath,nocase:!0,maxdepth:0})}}entry(){var e=this;return _asyncToGenerator(function*(){let t="";return e.sourceFile&&(t+=e.config.standalone?yield _fsJetpack2.default.readAsync(e.sourceFile):`source ${e.sourceFile}`),e.fpath&&(t+=`
fpath+=${e.fpath}`),t})()}download(){var e=this;return _asyncToGenerator(function*(){yield(0,_execa2.default)("git",["clone","--recursive","--",`https://github.com/${e.config.github}.git`,e.downloadPath])})()}update(){var e=this;return _asyncToGenerator(function*(){yield(0,_execa2.default)("git",["fetch","--all"],{cwd:e.downloadPath}),yield(0,_execa2.default)("git",["reset","--hard","origin/master","--"],{cwd:e.downloadPath})})()}}exports.Plugin=i;