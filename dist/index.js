"use strict";exports.__esModule=!0,exports.Plugin=exports.paths=void 0;var t=d(require("path")),e=d(require("findup-sync")),i=d(require("fs-extra")),a=d(require("lodash/isString")),s=d(require("lodash/isFunction")),o=d(require("nodegit")),n=d(require("xdg-basedir"));function d(t){return t&&t.__esModule?t:{default:t}}const h={downloadDir:t.default.join(n.default.data,"zsh-goggles"),configFile:t.default.join(n.default.config,"zsh-goggles","config.toml"),sourceFile:t.default.join(n.default.data,"zsh-goggles","plugins.zsh")};exports.paths=h;const l={standalone:!0,source:!0,fpath:!0};exports.Plugin=class{constructor([e,i]){this.name=e,this.downloadPath=t.default.join(h.downloadDir,e),Object.assign(this.config,l),(0,a.default)(i)?this.config.github=i:this.config={...l,...i}}get fpath(){const e=this.config.fpath;if(!1!==e)return(0,a.default)(e)?t.default.join(this.downloadPath,e):(0,s.default)(e)?e(this.downloadPath):this.downloadPath}get sourceFile(){const i=this.config.source;if(!1===i)return;if((0,a.default)(i))return t.default.join(this.downloadPath,i);if((0,s.default)(i))return i(this.downloadPath);const o=[`${this.name}?(.plugin).?(z)sh`,"*.plugin.zsh","init.zsh","*.zsh","*.sh"];return(0,e.default)(o,{cwd:this.downloadPath,nocase:!0,maxdepth:0})}async entry(){let t="";return this.sourceFile&&(this.config.standalone?t+=await i.default.readFile(this.sourceFile):t+=`source ${this.sourceFile}`),this.fpath&&(t+=`\nfpath+=${this.fpath}`),t}async download(){await o.default.Clone(`https://github.com/${this.config.github}.git`,this.downloadPath)}async update(){const t=await o.default.Repository.open(this.downloadPath);await t.fetchAll(),await t.mergeBranches("master","origin/master")}};