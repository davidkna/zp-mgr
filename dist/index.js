"use strict";function t(t){return t&&t.__esModule?t:{default:t}}function e(t){return function(){var e=this,i=arguments;return new Promise(function(n,o){function a(t,e){try{var i=s[t](e),u=i.value}catch(t){return void o(t)}i.done?n(u):Promise.resolve(u).then(r,function(t){a("throw",t)})}function r(t){a("next",t)}var s=t.apply(e,i);r()})}}exports.__esModule=!0,exports.Plugin=exports.paths=void 0;var i=t(require("path")),n=t(require("execa")),o=t(require("findup-sync")),a=t(require("fs-extra")),r=t(require("lodash/isString")),s=t(require("lodash/isFunction")),u=t(require("xdg-basedir"));const d={downloadDir:i.default.join(u.default.data,"zsh-goggles"),configFile:i.default.join(u.default.config,"zsh-goggles","config.toml"),sourceFile:i.default.join(u.default.data,"zsh-goggles","plugins.zsh")};exports.paths=d;const l={standalone:!0,source:!0,fpath:!0};class h{constructor([t,e]){this.name=t,this.downloadPath=i.default.join(d.downloadDir,t),this.config={},Object.assign(this.config,l),(0,r.default)(e)?this.config.github=e:Object.assign(this.config,e)}get fpath(){const t=this.config.fpath;if(!1!==t)return(0,r.default)(t)?i.default.join(this.downloadPath,t):(0,s.default)(t)?t(this.downloadPath):this.downloadPath}get sourceFile(){const t=this.config.source;if(!1===t)return;if((0,r.default)(t))return i.default.join(this.downloadPath,t);if((0,s.default)(t))return t(this.downloadPath);const e=[`${this.name}?(.plugin).?(z)sh`,"*.plugin.zsh","init.zsh","*.zsh","*.sh"];return(0,o.default)(e,{cwd:this.downloadPath,nocase:!0,maxdepth:0})}entry(){var t=this;return e(function*(){let e="";return t.sourceFile&&(t.config.standalone?e+=(yield a.default.readFile(t.sourceFile)):e+=`source ${t.sourceFile}`),t.fpath&&(e+=`\nfpath+=${t.fpath}`),e})()}download(){var t=this;return e(function*(){yield(0,n.default)("git",["clone","--recursive","--",`https://github.com/${t.config.github}.git`,t.downloadPath])})()}update(){var t=this;return e(function*(){yield(0,n.default)("git",["fetch","--all"],{cwd:t.downloadPath}),yield(0,n.default)("git",["reset","--hard","origin/master","--"],{cwd:t.downloadPath})})()}}exports.Plugin=h;