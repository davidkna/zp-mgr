"use strict";function t(t){return t&&t.__esModule?t:{default:t}}function e(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var n=require("crypto"),r=t(n),s=require("path"),i=t(s),u=require("execa"),a=t(u),o=require("glob"),l=t(o),c=require("fs-jetpack"),f=t(c),h=require("lodash.includes"),d=t(h),g=require("listr"),p=t(g),m=require("mkdirp"),z=t(m),y=require("xdg-basedir"),w=t(y);const j=i.default.join(w.default.data,"zsh_plugins");(0,z.default)(j);const k=["Tarrasch/zsh-colors","zsh-users/zsh-syntax-highlighting","zsh-users/zsh-history-substring-search","zsh-users/zsh-completions","mafredri/zsh-async","sindresorhus/pure"];class q{constructor(t){this.name=t;const e=r.default.createHash("sha1");e.update(t),this.hash=e.digest("hex"),this.clonePath=i.default.join(j,this.hash)}}const v=[],x=[],A=new p.default([{title:"Cloning plugins…",task:function(){return new p.default(k.map(((t,e)=>{return{title:`Cloning ${t}...`,task:function(){var n=k[e]=new q(t);const r=n.name,s=n.clonePath;switch(f.default.exists(i.default.join(s,".git"))){case!1:return f.default.exists(s)&&f.default.remove(s),(0,a.default)("git",["clone","--recursive","--",`https://github.com/${r}.git`,s]);case"dir":return a.default.sync("git",["fetch","--all"],{cwd:s}),(0,a.default)("git",["reset","--hard","origin/master","--"],{cwd:s});default:throw new Error("Invalid clone target!")}}}})),{concurrent:!0})}},{title:"Getting file ready to write…",task:function(){return new p.default(k.map((t=>{return{title:`Getting ${t.name} ready...`,task:function(){const e=t.name.split("/")[1],n=[`${e}.plugin.zsh`,"*.plugin.zsh","init.zsh","*.zsh","*.sh"];x.push(t.clonePath);for(let r=0;r<n.length;r++){const e=l.default.sync(i.default.join(t.clonePath,n[r]));if(0!==e.length){v.push(e[0]);break}}}}})),{concurrent:!0})}},{title:`Writing to ${i.default.join(j,"plugins.zsh")}…`,task:function(){const t=i.default.join(j,"plugins.zsh");return f.default.writeAsync(t,v.map((t=>`source ${t}`)).join("\n")+"\n"+x.map((t=>`fpath+=${t}`)).join("\n"))}},{title:"Cleaning up old plugins…",task:function(){const t=[].concat(e(k.map((t=>t.hash))),["plugins.zsh"]),n=f.default.list(j);n&&n.filter((e=>!(0,d.default)(t,e))).forEach((t=>f.default.remove(i.default.join(j,t))))}}]);A.run().catch((t=>{console.error(t),process.exit(1)}));
