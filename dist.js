"use strict";function e(e){return e&&e.__esModule?e:{default:e}}var t=require("crypto"),n=e(t),s=require("path"),i=e(s),r=require("execa"),u=e(r),a=require("glob"),l=e(a),o=require("fs-jetpack"),c=e(o),f=require("lodash.includes"),h=e(f),d=require("listr"),g=e(d),p=require("mkdirp"),m=e(p),z=require("xdg-basedir"),w=e(z);const j=i.default.join(w.default.data,"zsh_plugins");(0,m.default)(j);let k=["Tarrasch/zsh-colors","zsh-users/zsh-syntax-highlighting","zsh-users/zsh-history-substring-search","zsh-users/zsh-completions","mafredri/zsh-async","sindresorhus/pure"];class q{constructor(e){this.name=e;const t=n.default.createHash("sha1");t.update(e),this.hash=t.digest("hex"),this.clonePath=i.default.join(j,this.hash)}}const y=[],v=[],x=new g.default([{title:"Cloning plugins…",task:function(){return new g.default(k.map(((e,t)=>{return{title:`Cloning ${e}...`,task:function(){var n=k[t]=new q(e);const s=n.name,r=n.clonePath;switch(c.default.exists(i.default.join(r,".git"))){case!1:return c.default.exists(r)&&c.default.remove(r),(0,u.default)("git",["clone","--recursive","--",`https://github.com/${s}.git`,r]);case"dir":return u.default.sync("git",["fetch","--all"],{cwd:r}),(0,u.default)("git",["reset","--hard","origin/master","--"],{cwd:r});default:throw new Error("Invalid clone target!")}}}})),{concurrent:!0})}},{title:"Getting file ready to write…",task:function(){return new g.default(k.map((e=>{return{title:`Getting ${e.name} ready...`,task:function(){const t=e.name.split("/")[1],n=[`${t}.plugin.zsh`,"*.plugin.zsh","init.zsh","*.zsh","*.sh"];v.push(e.clonePath);for(let s=0;s<n.length;s++){const t=l.default.sync(i.default.join(e.clonePath,n[s]));if(0!==t.length){y.push(t[0]);break}}}}})),{concurrent:!0})}},{title:`Writing to ${i.default.join(j,"plugins.zsh")}…`,task:function(){const e=i.default.join(j,"plugins.zsh");return c.default.remove(e),c.default.writeAsync(e,y.map((e=>`source ${e}`)).join("\n")+"\n"+v.map((e=>`fpath+=${e}`)).join("\n"))}},{title:"Cleaning up old plugins…",task:function(){const e=k.map((e=>e.hash)),t=c.default.list(j);t&&t.filter((t=>!(0,h.default)(e,t))).forEach((e=>c.default.remove(i.default.join(j,e))))}}]);x.run().catch((e=>{console.error(e),process.exit(1)}));
